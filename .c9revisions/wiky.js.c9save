{"ts":1359499600201,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"/**\n * Wiky.js - Javascript library to converts Wiki MarkUp language to HTML.\n * You can do whatever with it. Please give me some credits (Apache License)\n * - Tanin Na Nakorn \n */\n\nvar wiky = {\n    options: {\n        'link-image': true //Preserve backward compat\n    }\n}\n\n\nwiky.process = function(wikitext, options) {\n    wiky.options = options || wiky.options;\n\n\tvar lines = wikitext.split(/\\r?\\n/);\n\t\n\tvar html = \"\";\n\t\n\tfor (i=0;i<lines.length;i++)\n\t{\n\t\tline = lines[i];\n\t\tif (line.match(/^===/)!=null && line.match(/===$/)!=null)\n\t\t{\n\t\t\thtml += \"<h2>\"+line.substring(3,line.length-3)+\"</h2>\";\n\t\t}\n\t\telse if (line.match(/^==/)!=null && line.match(/==$/)!=null)\n\t\t{\n\t\t\thtml += \"<h3>\"+line.substring(2,line.length-2)+\"</h3>\";\n\t\t}\n\t\telse if (line.match(/^:+/)!=null)\n\t\t{\n\t\t\t// find start line and ending line\n\t\t\tstart = i;\n\t\t\twhile (i < lines.length && lines[i].match(/^\\:+/)!=null) i++;\n\t\t\ti--;\n\t\t\t\n\t\t\thtml += wiky.process_indent(lines,start,i);\n\t\t}\n\t\telse if (line.match(/^----+(\\s*)$/)!=null)\n\t\t{\n\t\t\thtml += \"<hr/>\";\n\t\t}\n\t\telse if (line.match(/^(\\*+) /)!=null)\n\t\t{\n\t\t\t// find start line and ending line\n\t\t\tstart = i;\n\t\t\twhile (i < lines.length && lines[i].match(/^(\\*+|\\#\\#+)\\:? /)!=null) i++;\n\t\t\ti--;\n\t\t\t\n\t\t\thtml += wiky.process_bullet_point(lines,start,i);\n\t\t}\n\t\telse if (line.match(/^(\\#+) /)!=null)\n\t\t{\n\t\t\t// find start line and ending line\n\t\t\tstart = i;\n\t\t\twhile (i < lines.length && lines[i].match(/^(\\#+|\\*\\*+)\\:? /)!=null) i++;\n\t\t\ti--;\n\t\t\t\n\t\t\thtml += wiky.process_bullet_point(lines,start,i);\n\t\t}\n\t\telse \n\t\t{\n\t\t\thtml += wiky.process_normal(line);\n\t\t}\n\t\t\n\t\thtml += \"<br/>\\n\";\n\t}\n\t\n\treturn html;\n}\n\nwiky.process_indent = function(lines,start,end) {\n\tvar i = start;\n\t\n\tvar html = \"<dl>\";\n\t\n\tfor(var i=start;i<=end;i++) {\n\t\t\n\t\thtml += \"<dd>\";\n\t\t\n\t\tvar this_count = lines[i].match(/^(\\:+)/)[1].length;\n\t\t\n\t\thtml += wiky.process_normal(lines[i].substring(this_count));\n\t\t\n\t\tvar nested_end = i;\n\t\tfor (var j=i+1;j<=end;j++) {\n\t\t\tvar nested_count = lines[j].match(/^(\\:+)/)[1].length;\n\t\t\tif (nested_count <= this_count) break;\n\t\t\telse nested_end = j;\n\t\t}\n\t\t\n\t\tif (nested_end > i) {\n\t\t\thtml += wiky.process_indent(lines,i+1,nested_end);\n\t\t\ti = nested_end;\n\t\t}\n\t\t\n\t\thtml += \"</dd>\";\n\t}\n\t\n\thtml += \"</dl>\";\n\treturn html;\n}\n\nwiky.process_bullet_point = function(lines,start,end) {\n\tvar i = start;\n\t\n\tvar html = (lines[start].charAt(0)=='*')?\"<ul>\":\"<ol>\";\n\n    html += '\\n';\n\t\n\tfor(var i=start;i<=end;i++) {\n\t\t\n\t\thtml += \"<li>\";\n\t\t\n\t\tvar this_count = lines[i].match(/^(\\*+|\\#+) /)[1].length;\n\t\t\n\t\thtml += wiky.process_normal(lines[i].substring(this_count+1));\n\t\t\n\t\t// continue previous with #:\n\t\t{\n\t\t\tvar nested_end = i;\n\t\t\tfor (var j = i + 1; j <= end; j++) {\n\t\t\t\tvar nested_count = lines[j].match(/^(\\*+|\\#+)\\:? /)[1].length;\n\t\t\t\t\n\t\t\t\tif (nested_count < this_count) \n\t\t\t\t\tbreak;\n\t\t\t\telse {\n\t\t\t\t\tif (lines[j].charAt(nested_count) == ':') {\n\t\t\t\t\t\thtml += \"<br/>\" + wiky.process_normal(lines[j].substring(nested_count + 2));\n\t\t\t\t\t\tnested_end = j;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\ti = nested_end;\n\t\t}\n\t\t\n\t\t// nested bullet point\n\t\t{\n\t\t\tvar nested_end = i;\n\t\t\tfor (var j = i + 1; j <= end; j++) {\n\t\t\t\tvar nested_count = lines[j].match(/^(\\*+|\\#+)\\:? /)[1].length;\n\t\t\t\tif (nested_count <= this_count) \n\t\t\t\t\tbreak;\n\t\t\t\telse \n\t\t\t\t\tnested_end = j;\n\t\t\t}\n\t\t\t\n\t\t\tif (nested_end > i) {\n\t\t\t\thtml += wiky.process_bullet_point(lines, i + 1, nested_end);\n\t\t\t\ti = nested_end;\n\t\t\t}\n\t\t}\n\t\t\n\t\t// continue previous with #:\n\t\t{\n\t\t\tvar nested_end = i;\n\t\t\tfor (var j = i + 1; j <= end; j++) {\n\t\t\t\tvar nested_count = lines[j].match(/^(\\*+|\\#+)\\:? /)[1].length;\n\t\t\t\t\n\t\t\t\tif (nested_count < this_count) \n\t\t\t\t\tbreak;\n\t\t\t\telse {\n\t\t\t\t\tif (lines[j].charAt(nested_count) == ':') {\n\t\t\t\t\t\thtml += wiky.process_normal(lines[j].substring(nested_count + 2));\n\t\t\t\t\t\tnested_end = j;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\ti = nested_end;\n\t\t}\n\t\t\n\t\thtml += \"</li>\\n\";\n\t}\n\t\n\thtml += (lines[start].charAt(0)=='*')?\"</ul>\":\"</ol>\";\n    html += '\\n';\n\treturn html;\n}\n\nwiky.process_url = function(txt) {\n\t\n\tvar index = txt.indexOf(\" \"),\n        url = txt,\n        label = txt,\n        css = ' style=\"background: url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFZJREFUeF59z4EJADEIQ1F36k7u5E7ZKXeUQPACJ3wK7UNokVxVk9kHnQH7bY9hbDyDhNXgjpRLqFlo4M2GgfyJHhjq8V4agfrgPQX3JtJQGbofmCHgA/nAKks+JAjFAAAAAElFTkSuQmCC\\\") no-repeat scroll right center transparent;padding-right: 13px;\"';\n\t\n\tif (index !== -1) {\n\t\turl = txt.substring(0, index);\n\t\tlabel = txt.substring(index + 1);\n\t}\n\treturn '<a href=\"' + url + '\"' + (wiky.options['link-image'] ? css : '') + '>' + label + '</a>';\n};\n\nwiky.process_image = function(txt) {\n\tvar index = txt.indexOf(\" \");\n\turl = txt;\n\tlabel = \"\";\n\t\n\tif (index > -1) \n\t{\n\t\turl = txt.substring(0,index);\n\t\tlabel = txt.substring(index+1);\n\t}\n\t\n\t\n\treturn \"<img src='\"+url+\"' alt=\\\"\"+label+\"\\\" />\";\n}\n\nwiky.process_video = function(url) {\n\n\tif (url.match(/^(https?:\\/\\/)?(www.)?youtube.com\\//) == null)\n\t{\n\t\treturn \"<b>\"+url+\" is an invalid YouTube URL</b>\";\n\t}\n\t\n\tif ((result = url.match(/^(https?:\\/\\/)?(www.)?youtube.com\\/watch\\?(.*)v=([^&]+)/)) != null)\n\t{\n\t\turl = \"http://www.youtube.com/embed/\"+result[4];\n\t}\n\t\n\t\n\treturn '<iframe width=\"480\" height=\"390\" src=\"'+url+'\" frameborder=\"0\" allowfullscreen></iframe>';\n}\n\nwiky.process_normal = function(wikitext) {\n\t\n\t// Image\n\t{\n\t\tvar index = wikitext.indexOf(\"[[File:\");\n\t\tvar end_index = wikitext.indexOf(\"]]\", index + 7);\n\t\twhile (index > -1 && end_index > -1) {\n\t\t\t\n\t\t\twikitext = wikitext.substring(0,index) \n\t\t\t\t\t\t+ wiky.process_image(wikitext.substring(index+7,end_index)) \n\t\t\t\t\t\t+ wikitext.substring(end_index+2);\n\t\t\n\t\t\tindex = wikitext.indexOf(\"[[File:\");\n\t\t\tend_index = wikitext.indexOf(\"]]\", index + 7);\n\t\t}\n\t}\n\t\n\t// Video\n\t{\n\t\tvar index = wikitext.indexOf(\"[[Video:\");\n\t\tvar end_index = wikitext.indexOf(\"]]\", index + 8);\n\t\twhile (index > -1 && end_index > -1) {\n\t\t\t\n\t\t\twikitext = wikitext.substring(0,index) \n\t\t\t\t\t\t+ wiky.process_video(wikitext.substring(index+8,end_index)) \n\t\t\t\t\t\t+ wikitext.substring(end_index+2);\n\t\t\n\t\t\tindex = wikitext.indexOf(\"[[Video:\");\n\t\t\tend_index = wikitext.indexOf(\"]]\", index + 8);\n\t\t}\n\t}\n\t\n\t\n\t// URL\n\tvar protocols = [\"http\",\"ftp\",\"news\"];\n\t\n\tfor (var i=0;i<protocols.length;i++)\n\t{\n\t\tvar index = wikitext.indexOf(\"[\"+protocols[i]+\"://\");\n\t\tvar end_index = wikitext.indexOf(\"]\", index + 1);\n\t\twhile (index > -1 && end_index > -1) {\n\t\t\n\t\t\twikitext = wikitext.substring(0,index) \n\t\t\t\t\t\t+ wiky.process_url(wikitext.substring(index+1,end_index)) \n\t\t\t\t\t\t+ wikitext.substring(end_index+1);\n\t\t\n\t\t\tindex = wikitext.indexOf(\"[\"+protocols[i]+\"://\",end_index+1);\n\t\t\tend_index = wikitext.indexOf(\"]\", index + 1);\n\t\t\t\n\t\t}\n\t}\n\t\n\tvar count_b = 0;\n\tvar index = wikitext.indexOf(\"'''\");\n\twhile(index > -1) {\n\t\t\n\t\tif ((count_b%2)==0) wikitext = wikitext.replace(/'''/,\"<b>\");\n\t\telse wikitext = wikitext.replace(/'''/,\"</b>\");\n\t\t\n\t\tcount_b++;\n\t\t\n\t\tindex = wikitext.indexOf(\"'''\",index);\n\t}\n\t\n\tvar count_i = 0;\n\tvar index = wikitext.indexOf(\"''\");\n\twhile(index > -1) {\n\t\t\n\t\tif ((count_i%2)==0) wikitext = wikitext.replace(/''/,\"<i>\");\n\t\telse wikitext = wikitext.replace(/''/,\"</i>\");\n\t\t\n\t\tcount_i++;\n\t\t\n\t\tindex = wikitext.indexOf(\"''\",index);\n\t}\n\t\n\twikitext = wikitext.replace(/<\\/b><\\/i>/g,\"</i></b>\");\n\t\n\treturn wikitext;\n}\n\nif (typeof exports === 'object') {\n    for (var i in wiky) {\n        exports[i] = wiky[i];\n    }\n}\n"]],"start1":0,"start2":0,"length1":0,"length2":7385}]],"length":7385}
{"contributors":[],"silentsave":false,"ts":1359499597060,"patch":[[{"diffs":[[0,"+)\n\t{\n\t\t"],[1,"var "],[0,"line = l"]],"start1":449,"start2":449,"length1":16,"length2":20}]],"length":7389,"saved":false}
